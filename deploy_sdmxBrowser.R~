## require(httr)
## set_config(config(ssl.verifypeer = 0L))
## devtools::install_github("amattioc/SDMX", subdir = "RJSDMX")
devtools::install_github("AnalytixWare/ShinySky")

## create test application
## folder.test <- file.path("~/Downloads", "sdmxBrowserTest")
dir.create(path = folder.test)

files <- list(ui = "library(shiny)",
              server = "library(shiny)\nlibrary(RJSDMX)")

for (f in seq(along = files)) {
  file <- file.path(folder, paste0(names(files)[f], ".R"))
  filecon <- file(file)
  writeLines(text = files[[f]], con = filecon)
  close(filecon)
}

devtools::install_github("rstudio/shinyapps")

shinyapps::setAccountInfo(name='rjsdmx',
               token='C8705680E9ADD87838086C31F029E4A5',
               secret='hUsx5JVPYC2zSTFg5rFCJYlUj2PEhc4nyTnMYJNi')

folder.app <- file.path(dbpath, "GitHub", "SDMX", "RJSDMX", "inst", "sdmxBrowser")
## shinyapps::deployApp(appDir = folder.test)
shinyapps::deployApp(appDir = folder.app)


## Warning in untar2(tarfile, files, list, exdir, restore_times) :
##   skipping pax global extended headers
## ERROR: cannot extract package from ‘amattioc-SDMX-b5a8777.tar.gz’
## ################################### End Log ################################### 
## Error: Unhandled Exception: Child Task 24032325 failed: Error building image: Error building RJSDMX (1.3). Build exited with non-zero status: 1

pkg <- "RJSDMX"
description <- list(description = suppressWarnings(utils::packageDescription(pkg)))
shinyapps:::getRepository(description[[1]]) # GitHub
shinyapps:::validateRepository(pkg, shinyapps:::getRepository(description[[1]]))

shinyapps:::bundleApp(appDir = folder.test)
shinyapps:::createAppManifest(appDir = folder.test,
                              files


## ## ?shinyapps
## path.app.dest <- file.path(dbpath, "GitHub", "SDMX", "RJSDMX", "inst", "sdmxBrowser")
## ## shiny::runApp(path.app.dest)

## ## copy from desk
## path.app.source <- file.path(dbpath, "GitHub", "desk", "inst", "industry")

## folders.create <- c("data",
##                     file.path("data", "data_init"),
##                     "tools",
##                     ## file.path("tools", "app"),
##                     file.path("tools", "help"),
##                     file.path("tools", "help", "figures"),
##                     file.path("tools", "indic")
##                     )
## ## folder <- folders.create[1]
## for (folder in folders.create) {
##   dir.create(file.path(path.app.dest, folder))
## }

## folders.copy <- c("www",
##                   file.path("tools", "app")
##                   )
## ## folder <- folders.copy[1]
## for (folder in folders.copy) {
##   file.copy(from = file.path(path.app.source, folder),
##             to = dirname(file.path(path.app.dest, folder)), # need parent dir
##             recursive = TRUE)
## }

## files.base <- c(
##   ## "global.R", # modified
##   "ui.R",
##   "radiant.R",
##   "server.R"
##   )
## for (file in files.base) {
##   file.copy(from = file.path(path.app.source, file),
##             to = file.path(path.app.dest, file),
##             overwrite = TRUE)
## }


## module <- "sdmxBrowser"
## files.module <- c(file.path("data", "data_init", paste0(module, ".Rda")),
##                   file.path("tools", "help", paste0(module, ".md")),
##                   file.path("tools", "help", "figures", "SdmxClientSchema.png"),
##                   file.path("tools", "indic", paste0(module, ".R"))
##                   )
## ## file <- files.module[1]
## for (file in files.module) {
##   file.copy(from = file.path(path.app.source, file),
##             to = file.path(path.app.dest, file),
##             overwrite = TRUE)
## }

  


## shinyapps::setAccountInfo(name='rjsdmx',
##                token='C8705680E9ADD87838086C31F029E4A5',
##                secret='hUsx5JVPYC2zSTFg5rFCJYlUj2PEhc4nyTnMYJNi')

## detach("package:stan")
## detach("package:RJSDMX")
## devtools::install_github("bowerth/stan")
## devtools::install_github("amattioc/SDMX", subdir = "RJSDMX")
## devtools::install_github("hadley/dplyr")
## ## print(sessionInfo())

## ## path.app.dest <- file.path(dbpath, "GitHub", "SDMX", "RJSDMX", "inst", "sdmxBrowser")
## ## path.app.dest <- file.path(dbpath, "GitHub", "SDMX", "RJSDMX", "inst", "sdmxBrowserTest")



## shinyapps::appDependencies(appDir = path.app.dest)
## shinyapps::deployApp(appDir = path.app.dest)



## ## testing SDMX libraries
## require(RJSDMX)
## getProviders()
## getFlows("OECD")
## getFlows("IMF")
## getFlows("ECB")

